<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AR con MindAR - Fondos Mejorados</title>
  <!-- A-Frame y MindAR -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
      background: linear-gradient(135deg, #6e8efb, #a777e3);
    }
    #instructions {
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      text-align: center;
      color: white;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 20px;
      margin: 0 20px;
      z-index: 1000;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(5px);
    }
    #instructions h2 {
      margin: 0 0 10px 0;
      font-size: 18px;
    }
    #instructions p {
      margin: 5px 0;
      font-size: 16px;
    }
    #change-indicator {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px 15px;
      border-radius: 50px;
      color: #333;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      display: none;
      z-index: 1000;
    }
    .scene-container {
      width: 100%;
      height: 100vh;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div class="scene-container">
    <a-scene
      mindar-image="imageTargetSrc: ./targetss.mind; maxTrack: 3"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >

      <!-- 🔹 1. Pre-carga de modelos y de las 3 imágenes del plano -->
      <a-assets>
        <!-- modelos 3D de ejemplo (reemplaza con los tuyos) -->
        <a-asset-item id="modelOne" src="./bellsproutt.glb"></a-asset-item>
        <a-asset-item id="modelTwo" src="./wooperr.glb"></a-asset-item>
        <a-asset-item id="modelThree" src="./magikarpp.glb"></a-asset-item>
        <!-- imágenes para el plano -->
        <img id="img1" src="./bosque.jpg">
        <img id="img2" src="./pantano.jpg">
        <img id="img3" src="./mar.png">
      </a-assets>

      <!-- 🔹 2. Cámara -->
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- 🔹 3. Target 0: modelo + plano -->
      <a-entity mindar-image-target="targetIndex: 0">
        <a-gltf-model src="#modelOne"
                      position="0 -0.25 0"
                      rotation="0 0 0"
                      scale="0.1 0.1 0.1"
                      animation-mixer>
        </a-gltf-model>

        <!-- Plano de fondo - MÁS GRANDE y MÁS ATRÁS -->
        <a-plane class="background-plane"
                 src="#img1"
                 height="1.2"   
                 width="2.0"         
                 position="0 -1 -1" 
                 rotation="0 0 0"
                 data-target-index="0">
        </a-plane>
      </a-entity>

      <!-- 🔹 4. Target 1: segundo modelo -->
      <a-entity mindar-image-target="targetIndex: 1">
        <a-gltf-model src="#modelTwo"
                      position="0 -0.25 0"
                      rotation="0 0 0"
                      scale="0.1 0.1 0.1"
                      animation-mixer>
        </a-gltf-model>
        
        <!-- Plano para el segundo marcador - MÁS GRANDE y MÁS ATRÁS -->
        <a-plane class="background-plane"
                 src="#img1"
                 height="1.2"
                 width="2.0"
                 position="0 -1 -1"
                 rotation="0 0 0"
                 data-target-index="1">
        </a-plane>
      </a-entity>

      <!-- 🔹 5. Target 2: tercer modelo -->
      <a-entity mindar-image-target="targetIndex: 2">
        <a-gltf-model src="#modelThree"
                      position="0 -0.25 0"
                      rotation="0 0 0"
                      scale="0.1 0.1 0.1"
                      animation-mixer>
        </a-gltf-model>
        
        <!-- Plano para el tercer marcador - MÁS GRANDE y MÁS ATRÁS -->
        <a-plane class="background-plane"
                 src="#img1"
                 height="1.2"
                 width="2.0"
                 position="0 -1 -1"
                 rotation="0 0 0"
                 data-target-index="2">
        </a-plane>
      </a-entity>

    </a-scene>
  </div>

  <div id="change-indicator">¡Fondo cambiado!</div>

  <div id="instructions">
    <h2>¡Toca cualquier parte de la pantalla para cambiar el fondo!</h2>
    <p>Enfoca cualquiera de los marcadores y toca la pantalla para cambiar la imagen de fondo.</p>
  </div>

  <!-- 🔹 6. Lógica de cambio con click -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const scene = document.querySelector('a-scene');
      const images = ['#img1', '#img2', '#img3'];
      const changeIndicator = document.getElementById('change-indicator');
      
      // Objeto para guardar el índice actual de cada plano
      const currentImageIndex = {
        0: 0,
        1: 0,
        2: 0
      };
      
      let lastChangeTime = 0;
      let changeCooldown = 500; // medio segundo entre cambios
      
      // Función para cambiar todas las imágenes
      function changeAllBackgrounds() {
        const planes = document.querySelectorAll('.background-plane');
        const now = Date.now();
        
        // Enfriamiento para evitar cambios múltiples rápidos
        if (now - lastChangeTime < changeCooldown) return;
        
        lastChangeTime = now;
        
        planes.forEach(plane => {
          const targetIndex = parseInt(plane.getAttribute('data-target-index'));
          currentImageIndex[targetIndex] = (currentImageIndex[targetIndex] + 1) % images.length;
          plane.setAttribute('src', images[currentImageIndex[targetIndex]]);
        });
        
        // Mostrar indicador de cambio
        changeIndicator.style.display = 'block';
        setTimeout(() => {
          changeIndicator.style.display = 'none';
        }, 1500);
      }
      
      // Permitir cambio con toque o clic
      scene.addEventListener('touchstart', changeAllBackgrounds);
      scene.addEventListener('click', changeAllBackgrounds);
      
      scene.addEventListener('loaded', () => {
        console.log('Escena cargada y lista');
      });
    });
  </script>
</body>
</html>

